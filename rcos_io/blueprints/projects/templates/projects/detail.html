{% extends "base.html" %}

{% block title %}{{ project['name'] }}{% endblock %}

{% block content %}
<div class="container">
	<h1 class="display-1">{{ project['name'] }}</h1>

	{% include '/_includes/flashed_messages.html' %}

	<div>
		<blockquote class="blockquote">
			<p>{{ project["short_description"] }}</p>
		</blockquote>
		{% for tag in project['tags'] %}
			<span class="badge bg-secondary">{{ tag }}</span>
		{% endfor %}
		<div class="my-3">
			{{ project["description_markdown"] | safe }}
		</div>
	</div>

	<hr/>

	<div class="mb-5">
		<h2 class="mb-3">Team Members <span class="badge bg-secondary">{{ project["enrollments"]|length }} total</span></h2>
		{% for semester_id, enrollments in enrollments_by_semester_id.items() %}
		<div class="mb-3">
			<h3>{{ enrollments[0]["semester"]["name"] }} <span class="badge bg-secondary">{{ enrollments|length }}</span></h3>
			<ul>
				{% for user in enrollments %}
					<li>
						<a href="{{ url_for('users.detail', user_id=user['user_id']) }}">{{ user['user']['display_name'] }}</a>
						{% if user["is_project_lead"] %}
						<span class="badge bg-warning">Lead</span>
						{% endif %}
						<span class="badge bg-info">{{ user["credits"] }} credits</span>
					</li>
				{% endfor %}
			</ul>

			{% if enrollments[0]["semester_id"] == session.get("semester")["id"] and is_project_lead %}
			<div class="card">
				<div class="card-body">
					<form class="" action="{{ url_for('projects.add_member', project_id=project['id']) }}" method="post">
						<input type="hidden" name="semester_id" value="{{ enrollments[0]['semester_id'] }}">
						<div class="mb-3">
							<input class="form-control" name="user_identifier" type="text" placeholder="Student email or RCS ID" required>
						</div>
						<div class="input-group mb-3">
							<input class="form-control" name="credits" type="number" placeholder="Credit count (0 for experience)" value="4" required>
							<span class="input-group-text">credits</span>
						</div>
						<button class="btn btn-success">Add Team Member</button>
					</form>
				</div>
			</div>
			{% endif %}
		</div>
		{% endfor %}
	</div>
	
	{% if session.get("is_coordinator_or_above") %}
    <div class="btn-group ms-auto">
      <a class="btn btn-light" href="{{ config['HASURA_CONSOLE_URL'] }}/data/default/schema/public/tables/projects/browse" target="_blank">Edit in Hasura Console
        <i class="bi bi-box-arrow-up-right ms-2"></i>
      </a>
    </div>
    {% endif %}
</div>
{% endblock %}
